<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>倾诉 - 你的情感伙伴</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap');
        :root {
            --primary-color: #6B46C1;
            --primary-light: #9F7AEA;
            --primary-dark: #553C9A;
        }
        body {
            font-family: 'Noto Sans SC', sans-serif;
        }
        .page {
            display: none;
        }
        .page.active {
            display: block;
        }
        .nav-item {
            color: #718096;
            transition: all 0.3s ease;
        }
        .nav-item.active {
            color: var(--primary-color);
        }
        .message-container {
            height: calc(100vh - 180px);
            overflow-y: auto;
        }
        .communication-options {
            display: none;
        }
        .communication-options.active {
            display: flex;
        }
        .input-group {
            position: relative;
        }
        .input-group .verification-code {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary-color);
            cursor: pointer;
        }
        .input-group input {
            padding-right: 100px;
        }
        .agreement-checkbox {
            display: none;
        }
        .agreement-checkbox + label {
            cursor: pointer;
        }
        .agreement-checkbox:checked + label::before {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        .chat-input-container {
            position: relative;
        }
        .chat-toolbar {
            display: none;
            position: absolute;
            bottom: 100%;
            left: 0;
            right: 0;
            background: white;
            padding: 10px;
            border-top: 1px solid #e5e7eb;
        }
        .chat-toolbar.active {
            display: block;
        }
        .input-mode-icon {
            transition: all 0.3s ease;
        }
        .input-mode-icon.active {
            color: var(--primary-color);
        }
        .voice-record-button {
            display: none;
            position: relative;
            width: 100%;
            height: 100%;
        }
        .voice-record-button.active {
            display: block;
        }
        .text-input-button {
            display: block;
            width: 100%;
            height: 100%;
        }
        .text-input-button.active {
            display: none;
        }
        .voice-wave {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(107, 70, 193, 0.1);
            border-radius: 0.5rem;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .voice-wave.active {
            opacity: 1;
        }
        .voice-wave i {
            animation: wave 1s infinite;
        }
        @keyframes wave {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(1.5); opacity: 0; }
        }
        .voice-record-tip {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 20px 40px;
            border-radius: 10px;
            display: none;
            z-index: 1000;
        }
        .voice-record-tip.active {
            display: block;
        }
        .voice-record-tip i {
            font-size: 40px;
            margin-bottom: 10px;
        }
        .voice-record-tip.recording i {
            color: #ff4d4f;
        }
        .voice-record-tip.cancel i {
            color: #ffa940;
        }
        /* 微信风格的输入框样式 */
        .chat-input-area {
            display: flex;
            align-items: center;
            background-color: #f5f5f5;
            border-radius: 4px;
            padding: 8px;
            transition: all 0.3s ease;
        }
        .chat-input-area.voice-mode {
            background-color: #fff;
        }
        .chat-input-area input {
            border: none;
            background: transparent;
            flex: 1;
            padding: 8px;
            font-size: 16px;
        }
        .chat-input-area input:focus {
            outline: none;
        }
        .chat-input-area .voice-btn {
            width: 100%;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f5f5f5;
            border-radius: 4px;
            color: #333;
            font-size: 14px;
        }
        .chat-input-area .voice-btn i {
            margin-right: 5px;
        }
        .chat-input-area .send-btn {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary-color);
            font-size: 18px;
        }
        .chat-input-area .mode-switch-btn {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 18px;
        }
        .chat-input-area .mode-switch-btn.active {
            color: var(--primary-color);
        }
        .chat-input-area .plus-btn {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 18px;
        }
        .chat-input-area .plus-btn.active {
            color: var(--primary-color);
        }
        .voice-record-tip {
            position: fixed;
            top: 50%;
            left: 50%;
;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 20px 40px;
            border-radius: 10px;
            display: none;
            z-index: 1000;
            text-align: center;
        }
        .voice-record-tip.active {
            display: block;
        }
        .voice-record-tip i {
            font-size: 40px;
            margin-bottom: 10px;
            display: block;
        }
        .voice-record-tip.recording i {
            color: #ff4d4f;
        }
        .voice-record-tip.cancel i {
            color: #ffa940;
        }
        .voice-record-tip p {
            margin: 0;
            font-size: 14px;
        }
        .voice-record-tip .volume-indicator {
            display: flex;
            align-items: flex-end;
            justify-content: center;
            height: 40px;
            margin: 10px 0;
        }
        .voice-record-tip .volume-indicator .bar {
            width: 3px;
            background-color: #fff;
            margin: 0 1px;
            border-radius: 1px;
        }
        .voice-record-tip .volume-indicator .bar:nth-child(1) { height: 10px; }
        .voice-record-tip .volume-indicator .bar:nth-child(2) { height: 15px; }
        .voice-record-tip .volume-indicator .bar:nth-child(3) { height: 20px; }
        .voice-record-tip .volume-indicator .bar:nth-child(4) { height: 25px; }
        .voice-record-tip .volume-indicator .bar:nth-child(5) { height: 30px; }
        .voice-record-tip .volume-indicator .bar:nth-child(6) { height: 35px; }
        .voice-record-tip .volume-indicator .bar:nth-child(7) { height: 40px; }
        .voice-record-tip .volume-indicator .bar:nth-child(8) { height: 35px; }
        .voice-record-tip .volume-indicator .bar:nth-child(9) { height: 30px; }
        .voice-record-tip .volume-indicator .bar:nth-child(10) { height: 25px; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- 底部导航栏 -->
    <nav class="fixed bottom-0 w-full bg-white border-t border-gray-200 flex justify-around items-center h-16">
        <button onclick="showPage('chat')" class="nav-item flex flex-col items-center">
            <i class="fas fa-comments text-xl"></i>
            <span class="text-xs mt-1">倾诉</span>
        </button>
        <button onclick="showPage('create')" class="nav-item flex flex-col items-center">
            <i class="fas fa-user-plus text-xl"></i>
            <span class="text-xs mt-1">创建数字人</span>
        </button>
        <button onclick="showPage('love')" class="nav-item flex flex-col items-center">
            <i class="fas fa-heart text-xl"></i>
            <span class="text-xs mt-1">爱自己</span>
        </button>
        <button onclick="showPage('test')" class="nav-item flex flex-col items-center">
            <i class="fas fa-clipboard-list text-xl"></i>
            <span class="text-xs mt-1">心理测评</span>
        </button>
        <button onclick="showPage('profile')" class="nav-item flex flex-col items-center">
            <i class="fas fa-user text-xl"></i>
            <span class="text-xs mt-1">我的</span>
        </button>
    </nav>

    <!-- 登录页面 -->
    <div id="login" class="page active min-h-screen flex flex-col items-center justify-center p-4">
        <div class="w-full max-w-md">
            <h1 class="text-3xl font-bold text-center mb-8 text-indigo-600">倾诉</h1>
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="input-group mb-4">
                    <input type="tel" placeholder="请输入手机号" class="w-full p-3 border rounded-lg" id="phoneInput">
                </div>
                <div class="input-group mb-6">
                    <input type="text" placeholder="请输入验证码" class="w-full p-3 border rounded-lg" id="codeInput">
                    <span class="verification-code" onclick="sendVerificationCode()">获取验证码</span>
                </div>
                <div class="flex items-center mb-6">
                    <input type="checkbox" id="agreement" class="agreement-checkbox">
                    <label for="agreement" class="text-sm text-gray-600 ml-2">
                        我已阅读并同意<a href="#" class="text-indigo-600">《用户协议》</a>和<a href="#" class="text-indigo-600">《隐私政策》</a>
                    </label>
                </div>
                <button onclick="login()" class="w-full bg-indigo-600 text-white p-3 rounded-lg hover:bg-indigo-700" id="loginButton" disabled>登录</button>
            </div>
        </div>
    </div>

    <!-- 倾诉页面 -->
    <div id="chat" class="page min-h-screen pb-20">
        <div class="bg-white p-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <img src="https://images.unsplash.com/photo-1494790108377-be9c29b29330" class="w-12 h-12 rounded-full">
                    <div>
                        <h2 class="font-bold">小暖</h2>
                        <p class="text-sm text-gray-500">你的专属倾听者</p>
                    </div>
                </div>
                <button onclick="startCall()" class="p-2 text-indigo-600">
                    <i class="fas fa-phone text-xl"></i>
                </button>
            </div>
        </div>
        <div class="message-container p-4 space-y-4" id="messageContainer">
            <div class="flex items-start space-x-2">
                <img src="https://images.unsplash.com/photo-1494790108377-be9c29b29330" class="w-8 h-8 rounded-full">
                <div class="bg-white p-3 rounded-lg max-w-[80%]">
                    <p>你好，我是小暖。今天想和我聊些什么呢？</p>
                </div>
            </div>
        </div>
        <div class="fixed bottom-20 w-full bg-white border-t">
            <div class="chat-toolbar" id="chatToolbar">
                <div class="grid grid-cols-4 gap-4">
                    <button class="flex flex-col items-center text-indigo-600">
                        <i class="fas fa-image text-xl"></i>
                        <span class="text-xs mt-1">图片</span>
                    </button>
                    <button class="flex flex-col items-center text-indigo-600">
                        <i class="fas fa-camera text-xl"></i>
                        <span class="text-xs mt-1">拍照</span>
                    </button>
                    <button class="flex flex-col items-center text-indigo-600">
                        <i class="fas fa-file text-xl"></i>
                        <span class="text-xs mt-1">文件</span>
                    </button>
                    <button class="flex flex-col items-center text-indigo-600">
                        <i class="fas fa-smile text-xl"></i>
                        <span class="text-xs mt-1">表情</span>
                    </button>
                </div>
            </div>
            <div class="p-4">
                <div class="chat-input-area" id="chatInputArea">
                    <button class="plus-btn" onclick="toggleChatToolbar()">
                        <i class="fas fa-plus"></i>
                    </button>
                    <div class="chat-input-container flex-1">
                        <div class="text-input-button">
                            <input type="text" id="messageInput" placeholder="输入消息..." class="w-full">
                        </div>
                        <div class="voice-record-button">
                            <button class="voice-btn" 
                                    onmousedown="startVoiceRecord()" 
                                    onmouseup="stopVoiceRecord()"
                                    ontouchstart="startVoiceRecord()"
                                    ontouchend="stopVoiceRecord()">
                                <i class="fas fa-microphone"></i>按住说话
                            </button>
                            <div class="voice-wave">
                                <i class="fas fa-microphone text-2xl text-indigo-600"></i>
                            </div>
                        </div>
                    </div>
                    <button class="send-btn text-input-button" onclick="sendMessage()">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                    <button class="mode-switch-btn voice-record-button" onclick="toggleInputMode()">
                        <i class="fas fa-keyboard"></i>
                    </button>
                    <button class="mode-switch-btn text-input-button" onclick="toggleInputMode()">
                        <i class="fas fa-microphone"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 语音录制提示 -->
    <div class="voice-record-tip" id="voiceRecordTip">
        <div class="flex flex-col items-center">
            <i class="fas fa-microphone"></i>
            <div class="volume-indicator">
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
            </div>
            <p>手指上滑，取消发送</p>
        </div>
    </div>

    <!-- 通话页面 -->
    <div id="call" class="page min-h-screen bg-indigo-900 text-white">
        <div class="flex flex-col items-center justify-center h-screen">
            <div class="text-center mb-8">
                <img src="https://images.unsplash.com/photo-1494790108377-be9c29b29330" class="w-32 h-32 rounded-full mx-auto mb-4">
                <h2 class="text-2xl font-bold mb-2">小暖</h2>
                <p class="text-indigo-200">正在通话中...</p>
                <p class="text-3xl font-bold mt-4" id="callDuration">00:00</p>
            </div>
            <div class="flex space-x-8">
                <button class="p-4 bg-white bg-opacity-20 rounded-full">
                    <i class="fas fa-microphone text-2xl"></i>
                </button>
                <button onclick="endCall()" class="p-4 bg-red-500 rounded-full">
                    <i class="fas fa-phone-slash text-2xl"></i>
                </button>
                <button class="p-4 bg-white bg-opacity-20 rounded-full">
                    <i class="fas fa-volume-up text-2xl"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- 创建数字人页面 -->
    <div id="create" class="page min-h-screen pb-20">
        <div class="p-4">
            <h2 class="text-xl font-bold mb-4 text-indigo-600">创建你的数字人</h2>
            <div class="bg-white rounded-lg p-4 space-y-4">
                <div class="flex items-center justify-center">
                    <div class="w-32 h-32 bg-gray-200 rounded-full flex items-center justify-center cursor-pointer" onclick="showPage('imageUpload')">
                        <i class="fas fa-camera text-3xl text-gray-400"></i>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">关系</label>
                    <input type="text" id="relationInput" placeholder="例如：妈妈、爸爸、朋友" class="w-full p-2 border rounded-lg mt-1">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">称谓</label>
                    <input type="text" id="nameInput" placeholder="例如：宝贝、亲爱的" class="w-full p-2 border rounded-lg mt-1">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">声音</label>
                    <button class="w-full p-3 border rounded-lg mt-1 flex items-center justify-center space-x-2">
                        <i class="fas fa-microphone"></i>
                        <span>录制声音</span>
                    </button>
                </div>
                <button onclick="createDigitalHuman()" class="w-full bg-indigo-600 text-white p-3 rounded-lg hover:bg-indigo-700">创建</button>
            </div>
        </div>
    </div>

    <!-- 图片上传页面 -->
    <div id="imageUpload" class="page min-h-screen pb-20">
        <div class="p-4">
            <div class="flex items-center mb-6">
                <button onclick="showPage('create')" class="mr-4">
                    <i class="fas fa-arrow-left text-xl text-indigo-600"></i>
                </button>
                <h2 class="text-xl font-bold text-indigo-600">选择头像</h2>
            </div>
            <div class="bg-white rounded-lg p-4">
                <div class="mb-6">
                    <h3 class="font-bold mb-4">上传图片</h3>
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center">
                        <input type="file" id="imageInput" accept="image/*" class="hidden" onchange="previewImage()">
                        <label for="imageInput" class="cursor-pointer">
                            <i class="fas fa-cloud-upload-alt text-4xl text-indigo-600 mb-2"></i>
                            <p class="text-gray-600">点击或拖拽图片到此处上传</p>
                            <p class="text-xs text-gray-400 mt-1">支持 JPG、PNG 格式，大小不超过 5MB</p>
                        </label>
                    </div>
                </div>
                <div class="mb-6">
                    <h3 class="font-bold mb-4">预览</h3>
                    <div class="flex justify-center">
                        <div id="imagePreview" class="w-32 h-32 bg-gray-200 rounded-full flex items-center justify-center overflow-hidden">
                            <img id="previewImg" src="" alt="预览图" class="w-full h-full object-cover" style="display: none;">
                            <i class="fas fa-image text-3xl text-gray-400" id="previewIcon"></i>
                        </div>
                    </div>
                </div>
                <button onclick="confirmImageUpload()" class="w-full bg-indigo-600 text-white p-3 rounded-lg hover:bg-indigo-700">确认使用</button>
            </div>
        </div>
    </div>

    <!-- 爱自己页面 -->
    <div id="love" class="page min-h-screen pb-20">
        <div class="p-4">
            <div class="bg-white rounded-lg p-4 mb-4">
                <h2 class="text-xl font-bold mb-2 text-indigo-600">今日寄语</h2>
                <p class="text-gray-600">不必形色匆匆，不必光芒四射，做自己就好。</p>
            </div>
            <div class="grid grid-cols-3 gap-4">
                <div class="bg-white rounded-lg p-4 text-center">
                    <i class="fas fa-heart text-indigo-500 text-2xl mb-2"></i>
                    <p class="text-sm">善待自己</p>
                </div>
                <div class="bg-white rounded-lg p-4 text-center">
                    <i class="fas fa-star text-indigo-500 text-2xl mb-2"></i>
                    <p class="text-sm">保持希望</p>
                </div>
                <div class="bg-white rounded-lg p-4 text-center">
                    <i class="fas fa-sun text-indigo-500 text-2xl mb-2"></i>
                    <p class="text-sm">拥抱阳光</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 心理评测页面 -->
    <div id="test" class="page min-h-screen pb-20">
        <div class="p-4">
            <h2 class="text-xl font-bold mb-4 text-indigo-600">心理评测</h2>
            <div class="space-y-4">
                <div class="bg-white rounded-lg p-4">
                    <h3 class="font-bold mb-2">PHQ-9 抑郁量表</h3>
                    <p class="text-sm text-gray-600 mb-4">评估您近两周的情绪状态</p>
                    <button onclick="startTest('phq9')" class="w-full bg-indigo-600 text-white p-3 rounded-lg hover:bg-indigo-700">开始测试</button>
                </div>
                <div class="bg-white rounded-lg p-4">
                    <h3 class="font-bold mb-2">GAD-7 焦虑量表</h3>
                    <p class="text-sm text-gray-600 mb-4">评估您近两周的焦虑程度</p>
                    <button onclick="startTest('gad7')" class="w-full bg-indigo-600 text-white p-3 rounded-lg hover:bg-indigo-700">开始测试</button>
                </div>
            </div>
        </div>
    </div>

    <!-- PHQ-9 抑郁量表测试页面 -->
    <div id="phq9Test" class="page min-h-screen pb-20">
        <div class="p-4">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-bold text-indigo-600">PHQ-9 抑郁量表</h2>
                <span class="text-sm text-gray-500" id="phq9Progress">1/9</span>
            </div>
            <div class="bg-white rounded-lg p-4">
                <p class="text-lg mb-6" id="phq9Question">在过去的两周里，您是否经常感到情绪低落、沮丧或绝望？</p>
                <div class="space-y-4">
                    <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-indigo-50">
                        <input type="radio" name="phq9Answer" value="0" class="mr-3">
                        <span>完全没有</span>
                    </label>
                    <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-indigo-50">
                        <input type="radio" name="phq9Answer" value="1" class="mr-3">
                        <span>有几天</span>
                    </label>
                    <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-indigo-50">
                        <input type="radio" name="phq9Answer" value="2" class="mr-3">
                        <span>一半以上的时间</span>
                    </label>
                    <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-indigo-50">
                        <input type="radio" name="phq9Answer" value="3" class="mr-3">
                        <span>几乎每天</span>
                    </label>
                </div>
            </div>
            <div id="phq9NextButton">
                <button onclick="nextQuestion('phq9')" class="w-full bg-indigo-600 text-white p-3 rounded-lg mt-6 hover:bg-indigo-700">下一题</button>
            </div>
            <div id="phq9SubmitButton" style="display: none;">
                <button onclick="submitTest('phq9')" class="w-full bg-indigo-600 text-white p-3 rounded-lg mt-6 hover:bg-indigo-700">提交</button>
            </div>
        </div>
    </div>

    <!-- PHQ-9 测试结果页面 -->
    <div id="phq9Result" class="page min-h-screen pb-20">
        <div class="p-4">
            <div class="bg-white rounded-lg p-6 text-center">
                <h2 class="text-xl font-bold text-indigo-600 mb-4">测试结果</h2>
                <div class="w-24 h-24 bg-indigo-100 rounded-full mx-auto mb-6 flex items-center justify-center">
                    <span class="text-3xl font-bold text-indigo-600" id="phq9Score">0</span>
                </div>
                <p class="text-gray-600 mb-6" id="phq9ResultText">您的PHQ-9得分为：0分</p>
                <p class="text-sm text-gray-500 mb-8" id="phq9ResultDescription">根据您的得分，我们建议您与心理咨询师进行交流。</p>
                <button onclick="startChatAfterTest('phq9')" class="w-full bg-indigo-600 text-white p-3 rounded-lg hover:bg-indigo-700">开始对话</button>
            </div>
        </div>
    </div>

    <!-- GAD-7 焦虑量表测试页面 -->
    <div id="gad7Test" class="page min-h-screen pb-20">
        <div class="p-4">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-bold text-indigo-600">GAD-7 焦虑量表</h2>
                <span class="text-sm text-gray-500" id="gad7Progress">1/7</span>
            </div>
            <div class="bg-white rounded-lg p-4">
                <p class="text-lg mb-6" id="gad7Question">在过去的两周里，您是否经常感到紧张、焦虑或不安？</p>
                <div class="space-y-4">
                    <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-indigo-50">
                        <input type="radio" name="gad7Answer" value="0" class="mr-3">
                        <span>完全没有</span>
                    </label>
                    <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-indigo-50">
                        <input type="radio" name="gad7Answer" value="1" class="mr-3">
                        <span>有几天</span>
                    </label>
                    <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-indigo-50">
                        <input type="radio" name="gad7Answer" value="2" class="mr-3">
                        <span>一半以上的时间</span>
                    </label>
                    <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-indigo-50">
                        <input type="radio" name="gad7Answer" value="3" class="mr-3">
                        <span>几乎每天</span>
                    </label>
                </div>
            </div>
            <div id="gad7NextButton">
                <button onclick="nextQuestion('gad7')" class="w-full bg-indigo-600 text-white p-3 rounded-lg mt-6 hover:bg-indigo-700">下一题</button>
            </div>
            <div id="gad7SubmitButton" style="display: none;">
                <button onclick="submitTest('gad7')" class="w-full bg-indigo-600 text-white p-3 rounded-lg mt-6 hover:bg-indigo-700">提交</button>
            </div>
        </div>
    </div>

    <!-- GAD-7 测试结果页面 -->
    <div id="gad7Result" class="page min-h-screen pb-20">
        <div class="p-4">
            <div class="bg-white rounded-lg p-6 text-center">
                <h2 class="text-xl font-bold text-indigo-600 mb-4">测试结果</h2>
                <div class="w-24 h-24 bg-indigo-100 rounded-full mx-auto mb-6 flex items-center justify-center">
                    <span class="text-3xl font-bold text-indigo-600" id="gad7Score">0</span>
                </div>
                <p class="text-gray-600 mb-6" id="gad7ResultText">您的GAD-7得分为：0分</p>
                <p class="text-sm text-gray-500 mb-8" id="gad7ResultDescription">根据您的得分，我们建议您与心理咨询师进行交流。</p>
                <button onclick="startChatAfterTest('gad7')" class="w-full bg-indigo-600 text-white p-3 rounded-lg hover:bg-indigo-700">开始对话</button>
            </div>
        </div>
    </div>

    <!-- 个人中心页面 -->
    <div id="profile" class="page min-h-screen pb-20">
        <div class="p-4">
            <div class="bg-white rounded-lg p-4 mb-4">
                <div class="flex items-center space-x-4">
                    <img src="https://images.unsplash.com/photo-1494790108377-be9c29b29330" class="w-16 h-16 rounded-full">
                    <div>
                        <h2 class="font-bold">用户名</h2>
                        <p class="text-sm text-gray-500">普通会员</p>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-lg">
                <div class="p-4 border-b">
                    <div class="flex justify-between items-center cursor-pointer" onclick="showPage('vipRecharge')">
                        <span>会员充值</span>
                        <i class="fas fa-chevron-right text-gray-400"></i>
                    </div>
                </div>
                <div class="p-4 border-b">
                    <div class="flex justify-between items-center cursor-pointer" onclick="showPage('coinRecharge')">
                        <span>金币充值</span>
                        <i class="fas fa-chevron-right text-gray-400"></i>
                    </div>
                </div>
                <div class="p-4 border-b">
                    <div class="flex justify-between items-center cursor-pointer" onclick="showPage('versionUpdate')">
                        <span>版本更新</span>
                        <i class="fas fa-chevron-right text-gray-400"></i>
                    </div>
                </div>
                <div class="p-4 border-b">
                    <div class="flex justify-between items-center cursor-pointer" onclick="showPage('privacyPolicy')">
                        <span>隐私协议</span>
                        <i class="fas fa-chevron-right text-gray-400"></i>
                    </div>
                </div>
                <div class="p-4">
                    <div class="flex justify-between items-center cursor-pointer" onclick="showPage('feedback')">
                        <span>意见反馈</span>
                        <i class="fas fa-chevron-right text-gray-400"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 会员充值页面 -->
    <div id="vipRecharge" class="page min-h-screen pb-20">
        <div class="p-4">
            <div class="flex items-center mb-6">
                <button onclick="showPage('profile')" class="mr-4">
                    <i class="fas fa-arrow-left text-xl text-indigo-600"></i>
                </button>
                <h2 class="text-xl font-bold text-indigo-600">会员充值</h2>
            </div>
            <div class="bg-white rounded-lg p-4 mb-6">
                <h3 class="font-bold mb-4">会员权益</h3>
                <div class="space-y-4">
                    <div class="flex items-start">
                        <i class="fas fa-check-circle text-indigo-600 mt-1 mr-2"></i>
                        <div>
                            <p class="font-medium">无限次倾诉</p>
                            <p class="text-sm text-gray-500">与数字人无限制交流，随时倾诉心声</p>
                        </div>
                    </div>
                    <div class="flex items-start">
                        <i class="fas fa-check-circle text-indigo-600 mt-1 mr-2"></i>
                        <div>
                            <p class="font-medium">高级数字人</p>
                            <p class="text-sm text-gray-500">解锁更多高级数字人，体验不同角色</p>
                        </div>
                    </div>
                    <div class="flex items-start">
                        <i class="fas fa-check-circle text-indigo-600 mt-1 mr-2"></i>
                        <div>
                            <p class="font-medium">专业心理测评</p>
                            <p class="text-sm text-gray-500">获取专业心理测评报告和建议</p>
                        </div>
                    </div>
                    <div class="flex items-start">
                        <i class="fas fa-check-circle text-indigo-600 mt-1 mr-2"></i>
                        <div>
                            <p class="font-medium">优先客服支持</p>
                            <p class="text-sm text-gray-500">享受优先客服支持服务</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="grid grid-cols-3 gap-4 mb-6">
                <div class="bg-white rounded-lg p-4 text-center cursor-pointer" onclick="selectVipPlan('monthly')">
                    <p class="text-sm text-gray-500">月度会员</p>
                    <p class="text-xl font-bold text-indigo-600">¥29.9</p>
                    <p class="text-xs text-gray-400">每月</p>
                </div>
                <div class="bg-white rounded-lg p-4 text-center cursor-pointer" onclick="selectVipPlan('quarterly')">
                    <p class="text-sm text-gray-500">季度会员</p>
                    <p class="text-xl font-bold text-indigo-600">¥79.9</p>
                    <p class="text-xs text-gray-400">每季度</p>
                </div>
                <div class="bg-white rounded-lg p-4 text-center cursor-pointer" onclick="selectVipPlan('yearly')">
                    <p class="text-sm text-gray-500">年度会员</p>
                    <p class="text-xl font-bold text-indigo-600">¥299.9</p>
                    <p class="text-xs text-gray-400">每年</p>
                </div>
            </div>
            <button onclick="goToVipPayment()" class="w-full bg-indigo-600 text-white p-3 rounded-lg hover:bg-indigo-700">立即充值</button>
        </div>
    </div>

    <!-- 会员支付页面 -->
    <div id="vipPayment" class="page min-h-screen pb-20">
        <div class="p-4">
            <div class="flex items-center mb-6">
                <button onclick="showPage('vipRecharge')" class="mr-4">
                    <i class="fas fa-arrow-left text-xl text-indigo-600"></i>
                </button>
                <h2 class="text-xl font-bold text-indigo-600">确认支付</h2>
            </div>
            <div class="bg-white rounded-lg p-4 mb-6">
                <div class="flex justify-between items-center mb-4">
                    <span class="text-gray-600">商品</span>
                    <span id="vipPlanName" class="font-medium">月度会员</span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-gray-600">金额</span>
                    <span id="vipPlanPrice" class="text-xl font-bold text-indigo-600">¥29.9</span>
                </div>
            </div>
            <div class="bg-white rounded-lg p-4 mb-6">
                <h3 class="font-bold mb-4">支付方式</h3>
                <div class="space-y-4">
                    <label class="flex items-center p-3 border rounded-lg cursor-pointer">
                        <input type="radio" name="vipPaymentMethod" value="wechat" class="mr-3" checked>
                        <div class="flex items-center">
                            <i class="fab fa-weixin text-green-500 text-xl mr-2"></i>
                            <span>微信支付</span>
                        </div>
                    </label>
                    <label class="flex items-center p-3 border rounded-lg cursor-pointer">
                        <input type="radio" name="vipPaymentMethod" value="alipay" class="mr-3">
                        <div class="flex items-center">
                            <i class="fab fa-alipay text-blue-500 text-xl mr-2"></i>
                            <span>支付宝支付</span>
                        </div>
                    </label>
                </div>
            </div>
            <button onclick="confirmVipPayment()" class="w-full bg-indigo-600 text-white p-3 rounded-lg hover:bg-indigo-700">确认支付</button>
        </div>
    </div>

    <!-- 金币充值页面 -->
    <div id="coinRecharge" class="page min-h-screen pb-20">
        <div class="p-4">
            <div class="flex items-center mb-6">
                <button onclick="showPage('profile')" class="mr-4">
                    <i class="fas fa-arrow-left text-xl text-indigo-600"></i>
                </button>
                <h2 class="text-xl font-bold text-indigo-600">金币充值</h2>
            </div>
            <div class="grid grid-cols-3 gap-4 mb-6">
                <div class="bg-white rounded-lg p-4 text-center">
                    <p class="text-sm text-gray-500">100金币</p>
                    <p class="text-xl font-bold text-indigo-600">¥10</p>
                </div>
                <div class="bg-white rounded-lg p-4 text-center">
                    <p class="text-sm text-gray-500">500金币</p>
                    <p class="text-xl font-bold text-indigo-600">¥45</p>
                </div>
                <div class="bg-white rounded-lg p-4 text-center">
                    <p class="text-sm text-gray-500">1000金币</p>
                    <p class="text-xl font-bold text-indigo-600">¥88</p>
                </div>
            </div>
            <div class="bg-white rounded-lg p-4 mb-6">
                <h3 class="font-bold mb-4">支付方式</h3>
                <div class="space-y-4">
                    <label class="flex items-center p-3 border rounded-lg cursor-pointer">
                        <input type="radio" name="paymentMethod" value="wechat" class="mr-3">
                        <div class="flex items-center">
                            <i class="fab fa-weixin text-green-500 text-xl mr-2"></i>
                            <span>微信支付</span>
                        </div>
                    </label>
                    <label class="flex items-center p-3 border rounded-lg cursor-pointer">
                        <input type="radio" name="paymentMethod" value="alipay" class="mr-3">
                        <div class="flex items-center">
                            <i class="fab fa-alipay text-blue-500 text-xl mr-2"></i>
                            <span>支付宝支付</span>
                        </div>
                    </label>
                </div>
            </div>
            <button class="w-full bg-indigo-600 text-white p-3 rounded-lg hover:bg-indigo-700">确认支付</button>
        </div>
    </div>

    <!-- 版本更新页面 -->
    <div id="versionUpdate" class="page min-h-screen pb-20">
        <div class="p-4">
            <div class="flex items-center mb-6">
                <button onclick="showPage('profile')" class="mr-4">
                    <i class="fas fa-arrow-left text-xl text-indigo-600"></i>
                </button>
                <h2 class="text-xl font-bold text-indigo-600">版本更新</h2>
            </div>
            <div class="bg-white rounded-lg p-6 text-center">
                <div class="w-24 h-24 bg-indigo-100 rounded-full mx-auto mb-6 flex items-center justify-center">
                    <i class="fas fa-check text-4xl text-indigo-600"></i>
                </div>
                <h3 class="text-xl font-bold text-indigo-600 mb-2">当前已是最新版本</h3>
                <p class="text-gray-500">您当前使用的版本是最新版本，无需更新。</p>
                <p class="text-sm text-gray-400 mt-2">当前版本：1.0.0</p>
            </div>
        </div>
    </div>

    <!-- 隐私协议页面 -->
    <div id="privacyPolicy" class="page min-h-screen pb-20">
        <div class="p-4">
            <div class="flex items-center mb-6">
                <button onclick="showPage('profile')" class="mr-4">
                    <i class="fas fa-arrow-left text-xl text-indigo-600"></i>
                </button>
                <h2 class="text-xl font-bold text-indigo-600">隐私协议</h2>
            </div>
            <div class="bg-white rounded-lg p-4">
                <h3 class="font-bold mb-4">隐私政策</h3>
                <div class="text-sm text-gray-600 space-y-4">
                    <p>本隐私政策旨在帮助您了解我们如何收集、使用、存储和共享您的个人信息，以及您享有的相关权利。</p>
                    <p>我们非常重视您的隐私保护，并严格遵守相关法律法规。本隐私政策适用于我们的所有产品和服务。</p>
                    <h4 class="font-bold mt-4">1. 信息收集</h4>
                    <p>我们收集的信息包括：</p>
                    <ul class="list-disc pl-5">
                        <li>您提供的个人信息，如手机号码、昵称等</li>
                        <li>设备信息，如设备型号、操作系统版本等</li>
                        <li>使用记录，如您使用我们服务的频率、时长等</li>
                    </ul>
                    <h4 class="font-bold mt-4">2. 信息使用</h4>
                    <p>我们使用收集的信息用于：</p>
                    <ul class="list-disc pl-5">
                        <li>提供、维护和改进我们的服务</li>
                        <li>向您推送可能感兴趣的内容</li>
                        <li>进行安全防护和身份验证</li>
                    </ul>
                    <h4 class="font-bold mt-4">3. 信息共享</h4>
                    <p>我们不会向第三方出售您的个人信息。在以下情况下，我们可能会共享您的信息：</p>
                    <ul class="list-disc pl-5">
                        <li>获得您的明确同意</li>
                        <li>法律法规要求</li>
                        <li>保护我们的合法权益</li>
                    </ul>
                    <h4 class="font-bold mt-4">4. 信息安全</h4>
                    <p>我们采取多种安全措施保护您的个人信息，包括加密存储、访问控制等。</p>
                    <h4 class="font-bold mt-4">5. 您的权利</h4>
                    <p>您有权访问、更正、删除您的个人信息，也有权撤回同意。</p>
                    <p class="mt-4">如您对本隐私政策有任何疑问，请联系我们的客服。</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 意见反馈页面 -->
    <div id="feedback" class="page min-h-screen pb-20">
        <div class="p-4">
            <div class="flex items-center mb-6">
                <button onclick="showPage('profile')" class="mr-4">
                    <i class="fas fa-arrow-left text-xl text-indigo-600"></i>
                </button>
                <h2 class="text-xl font-bold text-indigo-600">意见反馈</h2>
            </div>
            <div class="bg-white rounded-lg p-4">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">反馈内容</label>
                    <textarea id="feedbackContent" placeholder="请详细描述您的问题或建议..." class="w-full p-3 border rounded-lg h-32"></textarea>
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">上传图片（可选）</label>
                    <div class="grid grid-cols-4 gap-2">
                        <div class="w-full h-24 bg-gray-100 rounded-lg flex items-center justify-center cursor-pointer">
                            <i class="fas fa-plus text-gray-400 text-xl"></i>
                        </div>
                    </div>
                </div>
                <button onclick="submitFeedback()" class="w-full bg-indigo-600 text-white p-3 rounded-lg hover:bg-indigo-700">提交反馈</button>
            </div>
        </div>
    </div>

    <!-- 创建数字人成功页面 -->
    <div id="createSuccess" class="page min-h-screen flex flex-col items-center justify-center p-4 bg-indigo-50">
        <div class="w-full max-w-md text-center">
            <div class="bg-white rounded-lg shadow-md p-8">
                <div class="w-24 h-24 bg-indigo-100 rounded-full mx-auto mb-6 flex items-center justify-center">
                    <i class="fas fa-check text-4xl text-indigo-600"></i>
                </div>
                <h2 class="text-2xl font-bold text-indigo-600 mb-4">创建成功</h2>
                <p class="text-gray-600 mb-8">你的数字人已经创建完成，现在可以开始对话了</p>
                <button onclick="startChatWithNewDigitalHuman()" class="w-full bg-indigo-600 text-white p-3 rounded-lg hover:bg-indigo-700">
                    开始对话
                </button>
            </div>
        </div>
    </div>

    <script>
        // 登录相关函数
        function sendVerificationCode() {
            const phone = document.getElementById('phoneInput').value;
            if (!phone || phone.length !== 11) {
                alert('请输入正确的手机号');
                return;
            }
            // 这里添加发送验证码的逻辑
            alert('验证码已发送');
        }

        function login() {
            const phone = document.getElementById('phoneInput').value;
            const code = document.getElementById('codeInput').value;
            const agreement = document.getElementById('agreement').checked;

            if (!phone || phone.length !== 11) {
                alert('请输入正确的手机号');
                return;
            }
            if (!code) {
                alert('请输入验证码');
                return;
            }
            if (!agreement) {
                alert('请阅读并同意用户协议和隐私政策');
                return;
            }

            // 登录成功后跳转到聊天页面
            showPage('chat');
        }

        // 监听协议勾选状态
        document.getElementById('agreement').addEventListener('change', function() {
            document.getElementById('loginButton').disabled = !this.checked;
        });

        // 聊天相关函数
        function toggleChatToolbar() {
            const toolbar = document.getElementById('chatToolbar');
            toolbar.classList.toggle('active');
            
            const plusBtn = document.querySelector('.plus-btn');
            plusBtn.classList.toggle('active');
        }

        function startCall() {
            showPage('call');
        }

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
            
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // 如果显示的是创建页面，清空表单
            if (pageId === 'create') {
                clearCreateDigitalHumanForm();
            }
            
            // 更新导航栏激活状态
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach(item => {
                if (item.querySelector('span').textContent === getNavItemText(pageId)) {
                    item.classList.add('active');
                }
            });
        }

        let callTimer = null;
        let callSeconds = 0;
        let voiceRecordTimer = null;
        let voiceRecordSeconds = 0;
        let isRecording = false;
        let isCanceling = false;
        let volumeInterval = null;

        function startCall() {
            showPage('call');
            callSeconds = 0;
            callTimer = setInterval(() => {
                callSeconds++;
                const minutes = Math.floor(callSeconds / 60);
                const seconds = callSeconds % 60;
                document.getElementById('callDuration').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }, 1000);
        }

        function endCall() {
            if (callTimer) {
                clearInterval(callTimer);
                callTimer = null;
            }
            showPage('chat');
        }

        function toggleInputMode() {
            const textInput = document.querySelector('.text-input-button');
            const voiceButton = document.querySelector('.voice-record-button');
            const keyboardIcon = document.querySelector('.fa-keyboard');
            const microphoneIcon = document.querySelector('.fa-microphone');
            const chatInputArea = document.getElementById('chatInputArea');
            
            if (textInput.classList.contains('active')) {
                textInput.classList.remove('active');
                voiceButton.classList.add('active');
                keyboardIcon.style.display = 'none';
                microphoneIcon.style.display = 'block';
                microphoneIcon.classList.add('active');
                keyboardIcon.classList.remove('active');
                chatInputArea.classList.add('voice-mode');
            } else {
                textInput.classList.add('active');
                voiceButton.classList.remove('active');
                keyboardIcon.style.display = 'block';
                microphoneIcon.style.display = 'none';
                keyboardIcon.classList.add('active');
                microphoneIcon.classList.remove('active');
                chatInputArea.classList.remove('voice-mode');
            }
        }

        function startVoiceRecord() {
            isRecording = true;
            isCanceling = false;
            voiceRecordSeconds = 0;
            const wave = document.querySelector('.voice-wave');
            wave.classList.add('active');
            
            // 显示录音提示
            const tip = document.getElementById('voiceRecordTip');
            tip.classList.add('active');
            tip.classList.add('recording');
            
            // 模拟音量变化
            updateVolumeIndicator();
            volumeInterval = setInterval(updateVolumeIndicator, 300);
            
            voiceRecordTimer = setInterval(() => {
                voiceRecordSeconds++;
                const button = document.querySelector('.voice-record-button button');
                button.innerHTML = `<i class="fas fa-microphone mr-2"></i>语音消息 ${voiceRecordSeconds}秒`;
            }, 1000);
            
            // 添加触摸移动事件，用于检测上滑取消
            document.addEventListener('touchmove', handleTouchMove);
        }
        
        function updateVolumeIndicator() {
            const bars = document.querySelectorAll('.volume-indicator .bar');
            bars.forEach((bar, index) => {
                // 随机生成音量高度
                const height = Math.floor(Math.random() * 30) + 10;
                bar.style.height = `${height}px`;
            });
        }
        
        function handleTouchMove(e) {
            if (!isRecording) return;
            
            const touch = e.touches[0];
            const startY = touch.clientY;
            
            // 如果上滑超过50px，则标记为取消状态
            if (startY < window.innerHeight / 2 - 50) {
                isCanceling = true;
                const tip = document.getElementById('voiceRecordTip');
                tip.classList.remove('recording');
                tip.classList.add('cancel');
                tip.querySelector('i').className = 'fas fa-times';
                tip.querySelector('p').textContent = '松开手指，取消发送';
            } else {
                isCanceling = false;
                const tip = document.getElementById('voiceRecordTip');
                tip.classList.remove('cancel');
                tip.classList.add('recording');
                tip.querySelector('i').className = 'fas fa-microphone';
                tip.querySelector('p').textContent = '手指上滑，取消发送';
            }
        }

        function stopVoiceRecord() {
            if (!isRecording) return;
            
            isRecording = false;
            const wave = document.querySelector('.voice-wave');
            wave.classList.remove('active');
            
            // 隐藏录音提示
            const tip = document.getElementById('voiceRecordTip');
            tip.classList.remove('active');
            tip.classList.remove('recording');
            tip.classList.remove('cancel');
            
            // 移除触摸移动事件
            document.removeEventListener('touchmove', handleTouchMove);
            
            // 清除音量指示器动画
            if (volumeInterval) {
                clearInterval(volumeInterval);
                volumeInterval = null;
            }
            
            if (voiceRecordTimer) {
                clearInterval(voiceRecordTimer);
                voiceRecordTimer = null;
                
                // 重置按钮文本
                const button = document.querySelector('.voice-record-button button');
                button.innerHTML = `<i class="fas fa-microphone mr-2"></i>按住说话`;

                // 如果取消发送，则不显示消息
                if (isCanceling) {
                    return;
                }

                // 发送语音消息
                const messageContainer = document.getElementById('messageContainer');
                
                // 添加用户语音消息
                const userMessageElement = document.createElement('div');
                userMessageElement.className = 'flex justify-end';
                userMessageElement.innerHTML = `
                    <div class="bg-indigo-600 text-white p-3 rounded-lg max-w-[80%]">
                        <div class="flex items-center">
                            <i class="fas fa-microphone mr-2"></i>
                            <span>语音消息 ${voiceRecordSeconds}秒</span>
                        </div>
                    </div>
                `;
                messageContainer.appendChild(userMessageElement);

                // 添加系统回复
                setTimeout(() => {
                    const systemMessageElement = document.createElement('div');
                    systemMessageElement.className = 'flex items-start space-x-2';
                    systemMessageElement.innerHTML = `
                        <img src="https://images.unsplash.com/photo-1494790108377-be9c29b29330" class="w-8 h-8 rounded-full">
                        <div class="bg-white p-3 rounded-lg max-w-[80%]">
                            <p>我在呢，你说，我听着呢</p>
                        </div>
                    `;
                    messageContainer.appendChild(systemMessageElement);
                    messageContainer.scrollTop = messageContainer.scrollHeight;
                }, 500);

                messageContainer.scrollTop = messageContainer.scrollHeight;
            }
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (message) {
                const messageContainer = document.getElementById('messageContainer');
                
                // 添加用户消息
                const userMessageElement = document.createElement('div');
                userMessageElement.className = 'flex justify-end';
                userMessageElement.innerHTML = `
                    <div class="bg-indigo-600 text-white p-3 rounded-lg max-w-[80%]">
                        <p>${message}</p>
                    </div>
                `;
                messageContainer.appendChild(userMessageElement);

                // 添加系统回复
                setTimeout(() => {
                    const systemMessageElement = document.createElement('div');
                    systemMessageElement.className = 'flex items-start space-x-2';
                    systemMessageElement.innerHTML = `
                        <img src="https://images.unsplash.com/photo-1494790108377-be9c29b29330" class="w-8 h-8 rounded-full">
                        <div class="bg-white p-3 rounded-lg max-w-[80%]">
                            <p>我在呢，你说，我听着呢</p>
                        </div>
                    `;
                    messageContainer.appendChild(systemMessageElement);
                    messageContainer.scrollTop = messageContainer.scrollHeight;
                }, 500);

                input.value = '';
                messageContainer.scrollTop = messageContainer.scrollHeight;
            }
        }

        document.getElementById('messageInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        function createDigitalHuman() {
            const relation = document.getElementById('relationInput').value;
            const name = document.getElementById('nameInput').value;
            const avatar = localStorage.getItem('digitalHumanAvatar') || 'https://images.unsplash.com/photo-1494790108377-be9c29b29330';
            
            if (!relation || !name) {
                alert('请填写完整信息');
                return;
            }

            // 保存数字人信息
            const digitalHuman = {
                relation: relation,
                name: name,
                avatar: avatar
            };
            localStorage.setItem('newDigitalHuman', JSON.stringify(digitalHuman));

            // 跳转到成功页面
            showPage('createSuccess');
        }

        function startChatWithNewDigitalHuman() {
            const digitalHuman = JSON.parse(localStorage.getItem('newDigitalHuman'));
            if (digitalHuman) {
                // 跳转到聊天页面
                showPage('chat');
                
                // 更新聊天界面
                const chatHeader = document.querySelector('#chat .bg-white .flex');
                chatHeader.innerHTML = `
                    <div class="flex items-center space-x-4">
                        <img src="${digitalHuman.avatar}" class="w-12 h-12 rounded-full">
                        <div>
                            <h2 class="font-bold">${digitalHuman.name}</h2>
                            <p class="text-sm text-gray-500">你的${digitalHuman.relation}</p>
                        </div>
                    </div>
                    <button onclick="startCall()" class="p-2 text-indigo-600">
                        <i class="fas fa-phone text-xl"></i>
                    </button>
                `;

                // 清空聊天记录
                const messageContainer = document.getElementById('messageContainer');
                messageContainer.innerHTML = `
                    <div class="flex items-start space-x-2">
                        <img src="${digitalHuman.avatar}" class="w-8 h-8 rounded-full">
                        <div class="bg-white p-3 rounded-lg max-w-[80%]">
                            <p>你好，我是${digitalHuman.name}。今天想和我聊些什么呢？</p>
                        </div>
                    </div>
                `;
            }
        }

        // 添加清空创建数字人表单的函数
        function clearCreateDigitalHumanForm() {
            document.getElementById('relationInput').value = '';
            document.getElementById('nameInput').value = '';
        }

        // 获取导航项对应的文本
        function getNavItemText(pageId) {
            const navTexts = {
                'chat': '倾诉',
                'create': '创建数字人',
                'love': '爱自己',
                'test': '心理测评',
                'profile': '我的'
            };
            return navTexts[pageId] || '';
        }

        // PHQ-9 抑郁量表问题
        const phq9Questions = [
            "在过去的两周里，您是否经常感到情绪低落、沮丧或绝望？",
            "在过去的两周里，您是否经常对日常活动失去兴趣或乐趣？",
            "在过去的两周里，您是否经常有睡眠问题（难以入睡、早醒或睡眠过多）？",
            "在过去的两周里，您是否经常感到疲倦或缺乏能量？",
            "在过去的两周里，您是否经常食欲不振或过度进食？",
            "在过去的两周里，您是否经常对自己感到失望或认为自己让家人失望？",
            "在过去的两周里，您是否经常难以集中注意力？",
            "在过去的两周里，您是否经常行动或说话比平时慢，或者感到坐立不安？",
            "在过去的两周里，您是否经常有自残或自杀的想法？"
        ];

        // GAD-7 焦虑量表问题
        const gad7Questions = [
            "在过去的两周里，您是否经常感到紧张、焦虑或不安？",
            "在过去的两周里，您是否经常无法停止或控制担忧？",
            "在过去的两周里，您是否经常过度担忧各种事情？",
            "在过去的两周里，您是否经常难以放松？",
            "在过去的两周里，您是否经常坐立不安？",
            "在过去的两周里，您是否经常容易烦恼或易怒？",
            "在过去的两周里，您是否经常感到害怕，就像要发生可怕的事情一样？"
        ];

        let currentPhq9Question = 0;
        let currentGad7Question = 0;
        let phq9Answers = [];
        let gad7Answers = [];

        function startTest(testType) {
            if (testType === 'phq9') {
                currentPhq9Question = 0;
                phq9Answers = [];
                document.getElementById('phq9Question').textContent = phq9Questions[0];
                document.getElementById('phq9Progress').textContent = `1/${phq9Questions.length}`;
                showPage('phq9Test');
            } else if (testType === 'gad7') {
                currentGad7Question = 0;
                gad7Answers = [];
                document.getElementById('gad7Question').textContent = gad7Questions[0];
                document.getElementById('gad7Progress').textContent = `1/${gad7Questions.length}`;
                showPage('gad7Test');
            }
        }

        function nextQuestion(testType) {
            if (testType === 'phq9') {
                const answer = document.querySelector('input[name="phq9Answer"]:checked');
                if (!answer) {
                    alert('请选择一个选项');
                    return;
                }
                phq9Answers.push(parseInt(answer.value));
                
                if (currentPhq9Question < phq9Questions.length - 1) {
                    currentPhq9Question++;
                    document.getElementById('phq9Question').textContent = phq9Questions[currentPhq9Question];
                    document.getElementById('phq9Progress').textContent = `${currentPhq9Question + 1}/${phq9Questions.length}`;
                    document.querySelectorAll('input[name="phq9Answer"]').forEach(input => input.checked = false);
                    
                    // 如果是最后一题，显示提交按钮
                    if (currentPhq9Question === phq9Questions.length - 1) {
                        document.getElementById('phq9NextButton').style.display = 'none';
                        document.getElementById('phq9SubmitButton').style.display = 'block';
                    }
                }
            } else if (testType === 'gad7') {
                const answer = document.querySelector('input[name="gad7Answer"]:checked');
                if (!answer) {
                    alert('请选择一个选项');
                    return;
                }
                gad7Answers.push(parseInt(answer.value));
                
                if (currentGad7Question < gad7Questions.length - 1) {
                    currentGad7Question++;
                    document.getElementById('gad7Question').textContent = gad7Questions[currentGad7Question];
                    document.getElementById('gad7Progress').textContent = `${currentGad7Question + 1}/${gad7Questions.length}`;
                    document.querySelectorAll('input[name="gad7Answer"]').forEach(input => input.checked = false);
                    
                    // 如果是最后一题，显示提交按钮
                    if (currentGad7Question === gad7Questions.length - 1) {
                        document.getElementById('gad7NextButton').style.display = 'none';
                        document.getElementById('gad7SubmitButton').style.display = 'block';
                    }
                }
            }
        }

        function submitTest(testType) {
            if (testType === 'phq9') {
                const answer = document.querySelector('input[name="phq9Answer"]:checked');
                if (!answer) {
                    alert('请选择一个选项');
                    return;
                }
                phq9Answers.push(parseInt(answer.value));
                
                // 计算得分
                const score = phq9Answers.reduce((a, b) => a + b, 0);
                
                // 显示结果页面
                document.getElementById('phq9Score').textContent = score;
                document.getElementById('phq9ResultText').textContent = `您的PHQ-9得分为：${score}分`;
                
                // 根据得分设置不同的描述
                let description = '';
                if (score <= 4) {
                    description = '您的情绪状态良好，请继续保持积极乐观的心态。';
                } else if (score <= 9) {
                    description = '您可能有轻度抑郁症状，建议您多与朋友交流，保持规律作息。';
                } else if (score <= 14) {
                    description = '您可能有中度抑郁症状，建议您与心理咨询师进行交流。';
                } else if (score <= 19) {
                    description = '您可能有中重度抑郁症状，建议您尽快寻求专业心理咨询师的帮助。';
                } else {
                    description = '您可能有重度抑郁症状，建议您尽快寻求专业医生的帮助。';
                }
                document.getElementById('phq9ResultDescription').textContent = description;
                
                // 跳转到结果页面
                showPage('phq9Result');
            } else if (testType === 'gad7') {
                const answer = document.querySelector('input[name="gad7Answer"]:checked');
                if (!answer) {
                    alert('请选择一个选项');
                    return;
                }
                gad7Answers.push(parseInt(answer.value));
                
                // 计算得分
                const score = gad7Answers.reduce((a, b) => a + b, 0);
                
                // 显示结果页面
                document.getElementById('gad7Score').textContent = score;
                document.getElementById('gad7ResultText').textContent = `您的GAD-7得分为：${score}分`;
                
                // 根据得分设置不同的描述
                let description = '';
                if (score <= 4) {
                    description = '您的焦虑水平较低，请继续保持平和的心态。';
                } else if (score <= 9) {
                    description = '您可能有轻度焦虑症状，建议您学习一些放松技巧。';
                } else if (score <= 14) {
                    description = '您可能有中度焦虑症状，建议您与心理咨询师进行交流。';
                } else {
                    description = '您可能有重度焦虑症状，建议您尽快寻求专业心理咨询师的帮助。';
                }
                document.getElementById('gad7ResultDescription').textContent = description;
                
                // 跳转到结果页面
                showPage('gad7Result');
            }
        }

        function startChatAfterTest(testType) {
            // 跳转到聊天页面
            showPage('chat');
            
            // 根据测试类型设置不同的初始消息
            const messageContainer = document.getElementById('messageContainer');
            let message = '';
            
            if (testType === 'phq9') {
                const score = phq9Answers.reduce((a, b) => a + b, 0);
                message = `我刚刚完成了PHQ-9抑郁量表测试，得分为${score}分。`;
            } else if (testType === 'gad7') {
                const score = gad7Answers.reduce((a, b) => a + b, 0);
                message = `我刚刚完成了GAD-7焦虑量表测试，得分为${score}分。`;
            }
            
            // 添加用户消息
            const userMessageElement = document.createElement('div');
            userMessageElement.className = 'flex justify-end';
            userMessageElement.innerHTML = `
                <div class="bg-indigo-600 text-white p-3 rounded-lg max-w-[80%]">
                    <p>${message}</p>
                </div>
            `;
            messageContainer.appendChild(userMessageElement);
            
            // 添加系统回复
            setTimeout(() => {
                const systemMessageElement = document.createElement('div');
                systemMessageElement.className = 'flex items-start space-x-2';
                systemMessageElement.innerHTML = `
                    <img src="https://images.unsplash.com/photo-1494790108377-be9c29b29330" class="w-8 h-8 rounded-full">
                    <div class="bg-white p-3 rounded-lg max-w-[80%]">
                        <p>感谢您完成心理测评。无论结果如何，请记住每个人都会有情绪波动，这是正常的。如果您需要倾诉或讨论测试结果，我很乐意倾听和陪伴您。</p>
                    </div>
                `;
                messageContainer.appendChild(systemMessageElement);
                messageContainer.scrollTop = messageContainer.scrollHeight;
            }, 500);
            
            messageContainer.scrollTop = messageContainer.scrollHeight;
        }

        function submitFeedback() {
            const content = document.getElementById('feedbackContent').value;
            if (!content) {
                alert('请输入反馈内容');
                return;
            }
            
            // 显示提交成功提示
            alert('提交成功');
            
            // 返回个人中心页面
            showPage('profile');
        }

        // 会员充值相关函数
        let selectedVipPlan = {
            type: 'monthly',
            name: '月度会员',
            price: '¥29.9'
        };

        function selectVipPlan(type) {
            // 移除所有选中状态
            document.querySelectorAll('#vipRecharge .grid > div').forEach(div => {
                div.classList.remove('border-2', 'border-indigo-600');
            });
            
            // 添加选中状态
            const selectedDiv = event.currentTarget;
            selectedDiv.classList.add('border-2', 'border-indigo-600');
            
            // 更新选中的会员类型
            if (type === 'monthly') {
                selectedVipPlan = {
                    type: 'monthly',
                    name: '月度会员',
                    price: '¥29.9'
                };
            } else if (type === 'quarterly') {
                selectedVipPlan = {
                    type: 'quarterly',
                    name: '季度会员',
                    price: '¥79.9'
                };
            } else if (type === 'yearly') {
                selectedVipPlan = {
                    type: 'yearly',
                    name: '年度会员',
                    price: '¥299.9'
                };
            }
        }

        function goToVipPayment() {
            // 更新支付页面上的会员信息
            document.getElementById('vipPlanName').textContent = selectedVipPlan.name;
            document.getElementById('vipPlanPrice').textContent = selectedVipPlan.price;
            
            // 跳转到支付页面
            showPage('vipPayment');
        }

        function confirmVipPayment() {
            const paymentMethod = document.querySelector('input[name="vipPaymentMethod"]:checked').value;
            
            // 显示支付成功提示
            alert('支付成功！');
            
            // 返回个人中心页面
            showPage('profile');
        }

        function previewImage() {
            const input = document.getElementById('imageInput');
            const preview = document.getElementById('previewImg');
            const icon = document.getElementById('previewIcon');
            
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                    icon.style.display = 'none';
                }
                
                reader.readAsDataURL(input.files[0]);
            }
        }
        
        function confirmImageUpload() {
            const preview = document.getElementById('previewImg');
            
            if (preview.src && preview.src !== window.location.href) {
                // 保存图片到本地存储
                localStorage.setItem('digitalHumanAvatar', preview.src);
                
                // 更新创建页面的头像
                const avatarContainer = document.querySelector('#create .w-32.h-32');
                avatarContainer.innerHTML = `<img src="${preview.src}" class="w-full h-full object-cover rounded-full">`;
                
                // 返回创建页面
                showPage('create');
            } else {
                alert('请先选择一张图片');
            }
        }
    </script>
</body>
</html>
